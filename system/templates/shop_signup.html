{% extends "base.html" %}
{% load i18n %}
{% load url from future %}

{% block js %}
	<script type="text/javascript" src="/static/jquery.form.js"></script>
	<script type="text/javascript" src="/static/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/static/jquery.validate.additional-methods.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$("table,tr,td").addClass("noborder");
			$("#id_display_name,#id_address").addClass("required");
			$("#id_username").addClass("required lettersdigits");
			$("#id_password,#id_re_password").addClass("required").attr("minlength", "6");
			$("#id_re_password").attr("equalTo", "#id_password");
			$("#id_email,#id_re_email").addClass("required email");
			$("#id_re_email").attr("equalTo", "#id_email");
			$("#id_phone_number").addClass("required digits");

			$("#signup-dialog-notice").dialog({
				autoOpen: false,
				modal: true,
				buttons: {
					"OK": function() { 
						$(this).dialog("close"); 
						$(location).attr("href", "/usercp/");
					}
				}
			});

			function formValidate() {
				return $("form").validate({
					errorClass: "text-error",
					validClass: "text-success",
					errorElement: "span",
					errorPlacement: function(error, element) {
						element.parent("td").next("td").html(error);
					}
				}).form();
			}
			$("form").ajaxForm({
				type: "POST",
				dataType: "json",
				beforeSubmit: formValidate,
				success: function(data) {
					if (data.res_username != "" || data.res_email != "") {
						$("#username-error").html(data.res_username).show();
						$("#email-error").html(data.res_email).show();
					}
					else
						$("#signup-dialog-notice").html("User's successfully registered").dialog("open");
				}
			});
		});
	</script>
{% endblock %}

{% block title %}MCS - User sign up{% endblock %}
{% block header_buttons %}<a class="button" href="/signin/">Sign in</a>{% endblock %}

{% block content %}
<div id="signup-form">
	<form class="block-center" action="" method="post">
		{% csrf_token %}
		<table>
			<tr>
				<td><strong>Tên hiển thị</strong></td>
				<td>{{ form.display_name }}</td>
				<td></td>
			</tr>
			<tr>
				<td><strong>Tên đăng ký:</strong> </td>
				<td>{{ form.username }}</td>
				<td class="text-error" id="username-error"></td>
			</tr>
			<tr>
				<td><strong>Mật khẩu:</strong></td>					
				<td>{{ form.password }}</td>
				<td></td>
			</tr>
			<tr>
				<td><strong>Nhập lại mật khẩu:</strong></td>
				<td>{{ form.re_password }}</td>
				<td></td>
			</tr>
			<tr>
				<td><strong>Email:</strong></td>
				<td>{{ form.email }}</td>
				<td class="text-error" id="email-error"></td>
			</tr>
			<tr>
				<td><strong>Nhập lại Email:</strong></td>
				<td>{{ form.re_email }}</td>
				<td></td>
			</tr>
			<tr>
				<td><strong>Địa chỉ:</strong></td>
				<td>{{ form.address }}</td>
				<td></td>
			</tr>
			<tr>
				<td><strong>Số điện thoại:</strong></td>
				<td>{{ form.phone_number }}</td>
				<td></td>
			</tr>
		</table>
		<input class="button" type="submit" value="Submit" id="submit"/>
	</form>
</div>
<div id="signup-dialog-notice"></div>
{% endblock %}